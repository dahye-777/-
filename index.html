<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>상담 리스트 뷰어</title>
    <link rel="stylesheet" href="styles.css" />

    <!-- SheetJS (CDN) with local fallback -->
    <!-- TODO: 필요 시 버전 고정/업데이트 -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js" defer onerror="var s=document.createElement('script');s.src='libs/xlsx.min.js';document.head.appendChild(s);"></script>

    <!-- Chart.js (CDN) with local fallback -->
    <!-- TODO: 차트 컬러/옵션 커스터마이즈 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer onerror="var s=document.createElement('script');s.src='libs/chart.umd.js';document.head.appendChild(s);"></script>
</head>
<body>
    <header class="app-header" role="banner" aria-label="앱 헤더">
        <h1 class="app-title">상담 리스트 뷰어</h1>
        <div class="header-actions">
            <label for="excel-input" class="btn primary" aria-label="엑셀 선택 버튼">엑셀 선택</label>
            <input id="excel-input" type="file" accept=".xls,.xlsx" aria-label="엑셀 파일 업로드" />
        </div>
    </header>

    <nav class="tabs" role="tablist" aria-label="메인 탭">
        <button class="tab active" role="tab" aria-selected="true" aria-controls="tab-list" data-tab="tab-list">전체 목록</button>
        <button class="tab" role="tab" aria-selected="false" aria-controls="tab-stats" data-tab="tab-stats">Stats</button>
        <button class="tab" role="tab" aria-selected="false" aria-controls="tab-filter" data-tab="tab-filter">Filter</button>
        <button class="tab" role="tab" aria-selected="false" aria-controls="tab-trend" data-tab="tab-trend">Trend</button>
    </nav>

    <main class="container" aria-label="컨텐츠">
        <!-- 전체 목록 탭 -->
        <section id="tab-list" class="tab-panel active" role="tabpanel" aria-label="전체 목록">
            <div class="toolbar">
                <div class="search-group">
                    <input id="search-input" type="text" placeholder="제목/내용/학원명 검색" aria-label="검색어 입력" />
                    <button id="search-btn" class="btn" aria-label="검색 실행">Search</button>
                </div>
                <div class="list-meta" aria-live="polite">
                    <span id="list-count">0건</span>
                </div>
            </div>
            <div class="table-wrapper">
                <table id="main-table" class="data-table" aria-label="전체 목록 테이블">
                    <thead>
                        <tr>
                            <th>구분</th>
                            <th>서비스 상품</th>
                            <th>제목</th>
                            <th>내용</th>
                            <th>학원명</th>
                            <th>학원코드</th>
                            <th>처리상태</th>
                            <th>작성일</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="pagination" aria-label="페이지네이션">
                <button id="prev-page" class="btn" aria-label="이전 페이지">Prev</button>
                <span id="page-info">0 / 0</span>
                <button id="next-page" class="btn" aria-label="다음 페이지">Next</button>
                <select id="page-size" aria-label="페이지 크기 선택">
                    <option value="10">10</option>
                    <option value="25" selected>25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>
            </div>
        </section>

        <!-- Stats 탭 -->
        <section id="tab-stats" class="tab-panel" role="tabpanel" aria-label="통계">
            <div class="stats-container">
                <!-- 1. 날짜 기준 -->
                <div class="filter-group">
                    <h4>날짜 기준</h4>
                    <div class="input-group">
                        <label for="year-input">연도</label>
                        <input id="year-input" type="number" placeholder="예: 2024" min="2000" max="2030" />
                    </div>
                    <div class="input-group">
                        <label for="month-input">월</label>
                        <input id="month-input" type="number" placeholder="예: 12" min="1" max="12" />
                    </div>
                    <div class="input-group">
                        <label for="day-input">일</label>
                        <input id="day-input" type="number" placeholder="예: 25" min="1" max="31" />
                    </div>
                </div>

                <!-- 2. 구분 기준 -->
                <div class="filter-group">
                    <h4>구분 기준</h4>
                    <div class="input-group">
                        <label for="type-select">유형</label>
                        <select id="type-select">
                            <option value="">전체</option>
                        </select>
                    </div>
                </div>

                <!-- 3. 상품 기준 -->
                <div class="filter-group">
                    <h4>상품 기준</h4>
                    <div class="input-group">
                        <label for="service-select">유형</label>
                        <select id="service-select">
                            <option value="">전체</option>
                        </select>
                    </div>
                </div>

                <!-- Stats 조회 버튼 -->
                <div class="stats-button-section">
                    <button id="stats-btn" class="btn primary">Stats 조회</button>
                </div>
            </div>
            
            <!-- 결과 출력 영역 (하단 가로형) -->
            <div class="result-section-bottom">
                <div id="result-box" class="result-box">
                    엑셀 파일을 업로드하고 조건을 설정한 후 "Stats 조회" 버튼을 클릭하세요.
                </div>
            </div>
        </section>

        <!-- Filter 탭 -->
        <section id="tab-filter" class="tab-panel" role="tabpanel" aria-label="필터">
            <div class="filters">
                <div class="filter-item">
                    <label for="filter-type">구분</label>
                    <select id="filter-type" multiple aria-label="구분 선택"></select>
                </div>
                <div class="filter-item">
                    <label for="filter-service">서비스상품</label>
                    <select id="filter-service" multiple aria-label="서비스상품 선택"></select>
                </div>
                <div class="filter-item">
                    <label for="filter-status">처리상태</label>
                    <select id="filter-status" multiple aria-label="처리상태 선택"></select>
                </div>
                <div class="filter-item checkbox-item">
                    <label class="switch">
                        <input type="checkbox" id="filter-has-code" aria-label="학원코드 유무 필터" />
                        <span class="slider"></span>
                    </label>
                    <span>학원코드 유</span>
                </div>
                <div class="filter-actions">
                    <button id="filter-reset" class="btn" aria-label="필터 초기화">초기화</button>
                    <span class="badge" id="filter-count">0건</span>
                </div>
            </div>

            <div class="table-wrapper">
                <table id="filter-table" class="data-table" aria-label="필터 결과 테이블">
                    <thead>
                        <tr>
                            <th>구분</th>
                            <th>서비스 상품</th>
                            <th>제목</th>
                            <th>내용</th>
                            <th>학원명</th>
                            <th>학원코드</th>
                            <th>처리상태</th>
                            <th>작성일</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </section>

        <!-- Trend 탭 -->
        <section id="tab-trend" class="tab-panel" role="tabpanel" aria-label="추세">
            <div class="trend-toolbar">
                <label class="switch">
                    <input type="checkbox" id="trend-toggle" aria-label="월별 집계 토글" />
                    <span class="slider"></span>
                </label>
                <span>월별 집계</span>
            </div>
            <div class="chart-card">
                <div class="empty" id="empty-trend" hidden>데이터가 없습니다.</div>
                <canvas id="trend-chart" aria-label="작성일 기준 추세 차트"></canvas>
            </div>
        </section>
    </main>

    <div id="toast" role="alert" aria-live="assertive" hidden></div>

    <!-- 모달 팝업 -->
    <div id="modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>상세 정보</h3>
                <button id="modal-close" class="modal-close" aria-label="닫기">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-info-grid">
                    <div class="modal-info-item">
                        <label>구분:</label>
                        <span id="modal-type" class="modal-value"></span>
                    </div>
                    <div class="modal-info-item">
                        <label>서비스 상품:</label>
                        <span id="modal-service" class="modal-value"></span>
                    </div>
                    <div class="modal-info-item">
                        <label>제목:</label>
                        <span id="modal-title" class="modal-value"></span>
                    </div>
                    <div class="modal-info-item">
                        <label>내용:</label>
                        <span id="modal-content" class="modal-value"></span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="modal-close-btn" class="btn">닫기</button>
            </div>
        </div>
    </div>

    <script src="app.js" defer></script>
</body>
</html>